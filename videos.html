<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utfâ€‘8">
<title>ARCS</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
/* ------------------------------------- global ------------------------------------- */
body{
  font-family:Arial,Helvetica,sans-serif;
  background:#0f172a;
  color:#f8fafc;
  margin:0;
}
h1{ text-align:center;margin:0 0 20px;}

/* ------------------------------------- grid ------------------------------------- */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(300px,1fr));
  gap:20px;
  width:100%;
}
.card{
  background:rgba(255,255,255,.08);
  padding:15px;
  border-radius:10px;
  backdrop-filter:blur(6px);
  display:flex;
  flex-direction:column;
  align-items:stretch;
}
iframe{
  width:100%;
  height:400px;
  border:none;
  border-radius:8px;
  background:#000;
}

/* ------------------------------------- meta ------------------------------------- */
.title{font-size:18px;margin-top:10px;font-weight:bold;}
.date{opacity:.8;margin-top:5px;}
.note{margin-top:8px;opacity:.9;}
.metadata{font-size:.9rem;margin-top:8px;opacity:.9;}
.meta-item{display:flex;gap:5px;flex-wrap:wrap;}
.meta-key{font-weight:bold;}
.meta-value{margin-left:2px;}

/* ------------------------------------- buttons ------------------------------------ */
.button-group{
  margin-top:10px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.icon-btn{
  padding:6px 12px;
  background:#1e40af;
  color:#fff;
  border-radius:5px;
  cursor:pointer;
  border:none;
  font-size:14px;
  display:flex;
  align-items:center;
  justify-content:center;
}
.icon-btn:hover{background:#1d4eb8;}
.card.highlight{border:2px solid #3b82f6;}

/* ------------------------------------- share modal --------------------------------- */
#shareDialog{
  display:none;
  position:fixed;
  top:50%; left:50%;
  transform:translate(-50%,-50%);
  background:#1e293b;
  padding:20px;
  border-radius:8px;
  color:#f8fafc;
  z-index:2000;
  min-width:260px;
}
#shareDialog input{
  width:100%;
  padding:8px;
  margin-bottom:10px;
  font-size:14px;
  border-radius:4px;
  border:1px solid #374151;
  background:#111827;
  color:#f8fafc;
}
#shareDialog button{
  padding:6px 12px;
  background:#1e40af;
  color:#fff;
  border:none;
  border-radius:5px;
  cursor:pointer;
}
#shareDialog button:hover{background:#1d4eb8;}
</style>
</head>

<body>
<h1>ARCS</h1>
<div id="gallery" class="grid"></div>

<!-- Share modal -->
<div id="shareDialog">
  <p>Share this ARC:</p>
  <input type="text" id="shareLinkInput" readonly>
  <button onclick="copyShareLink()">Copy</button>
</div>

<script>
/* ------------------------------------------------ configuration -------------------------------- */
const SHARE_BASE =
  "https://yan-1-related-1.github.io/yan-1-website-shared-links-redirecting/archive-profile-images-page-shared-links-redirecting.html?image_id=";

/* ------------------------------------------------ utilities ----------------------------------- */
function getQueryParam(name){ const q = new URLSearchParams(window.location.search); return q.get(name); }
function recordKey(obj, index){ return obj.id ?? obj.image_id ?? index; }

/* ------------------------------------------------ shareâ€‘dialog --------------------------------- */
function showShareDialog(link){
  const dlg   = document.getElementById('shareDialog');
  const input = document.getElementById('shareLinkInput');
  input.value = link;
  dlg.style.display = 'block';
}
function copyShareLink(){
  const input = document.getElementById('shareLinkInput');
  input.select();
  if (navigator.clipboard && window.isSecureContext){
    navigator.clipboard.writeText(input.value).then(()=>alert('Link copied to clipboard!'));
  }else{
    document.execCommand('copy');
    alert('Link copied to clipboard!');
  }
}
document.addEventListener('click', ev=>{
  const dlg = document.getElementById('shareDialog');
  if (dlg.style.display==='block' && !dlg.contains(ev.target)){
    dlg.style.display='none';
  }
});

/* ------------------------------------------------ fullscreen ------------------------------------ */
function requestFullscreen(frame){
  if (frame.requestFullscreen)          frame.requestFullscreen();
  else if (frame.webkitRequestFullscreen) frame.webkitRequestFullscreen();
  else if (frame.msRequestFullscreen)    frame.msRequestFullscreen();
}

/* ------------------------------------------------ webâ€‘share ------------------------------------- */
async function shareArc(link, title){
  // 1ï¸âƒ£ try native webâ€‘share
  if (navigator.share){
    try{
      await navigator.share({
        title: title || 'Shared ARC',
        text:  'Take a look at this ARC',
        url:   link
      });
      return;               // successful
    }catch(_){ /* user cancelled or error â€“ fallâ€‘back */
    }
  }
  // 2ï¸âƒ£ fallback to modal
  showShareDialog(link);
}

/* ------------------------------------------------ main --------------------------------------- */
async function loadVideos(){
  // load videos JSON
  const resp   = await fetch('videos.json');
  const items  = await resp.json();

  /* Order newest â†’ oldest */
  items.sort((a,b)=>{
    const ai = typeof a.id==='number'? a.id : (Number(a.id)||0);
    const bi = typeof b.id==='number'? b.id : (Number(b.id)||0);
    return bi - ai;
  });

  const container  = document.getElementById('gallery');
  container.innerHTML='';
  const targetId = getQueryParam('image_id');

  items.forEach((obj, index)=>{
    const card = document.createElement('div');
    card.className='card';
    const key = recordKey(obj, index);
    card.dataset.pdfId = key;          /* for highlight later */

    /* ---- iframe (or video) ------------------------------------------------- */
    const embedUrl = obj.archive_url
          ? obj.archive_url.replace('/details/','/embed/')
          : (obj.video_url ?? '');
    const iframe = document.createElement('iframe');
    iframe.src = embedUrl;
    iframe.allowFullscreen = true;
    iframe.style.border = 'none';
    iframe.style.background = '#fff';
    card.appendChild(iframe);

    /* ---- metadata ------------------------------------------------ */
    const titleDiv = document.createElement('div'); titleDiv.className='title'; titleDiv.textContent = obj.title ?? ''; card.appendChild(titleDiv);
    const dateDiv  = document.createElement('div'); dateDiv.className='date';  dateDiv.textContent = obj.date ?? '';  card.appendChild(dateDiv);
    const noteDiv  = document.createElement('div'); noteDiv.className='note';  noteDiv.textContent = obj.note ?? '';  card.appendChild(noteDiv);

    const metaDiv = document.createElement('div'); metaDiv.className='metadata';
    const skip = new Set(['title','date','note','archive_url','comment_url','video_url']);
    Object.entries(obj).forEach(([k,v])=>{
      if (skip.has(k)) return;
      const item = document.createElement('div'); item.className='meta-item';
      const keySpan = document.createElement('span'); keySpan.className='meta-key'; keySpan.textContent = k + ':';
      const valSpan = document.createElement('span'); valSpan.className='meta-value'; valSpan.textContent = typeof v==='object'? JSON.stringify(v) : `${v}`;
      item.appendChild(keySpan); item.appendChild(valSpan);
      metaDiv.appendChild(item);
    });
    card.appendChild(metaDiv);

    /* ---- buttons ------------------------------------------------ */
    const btnGroup = document.createElement('div'); btnGroup.className='button-group';

    /* Fullscreen button */
    const fsBtn = document.createElement('button');
    fsBtn.className='icon-btn'; fsBtn.title='Fullscreen'; fsBtn.innerHTML='â›¶';
    fsBtn.onclick = ()=>requestFullscreen(iframe);
    btnGroup.appendChild(fsBtn);

    /* Comments button */
    const cmBtn = document.createElement('button');
    cmBtn.className='icon-btn'; cmBtn.title='Comments'; cmBtn.innerHTML='ðŸ’¬';
    cmBtn.onclick = ()=>window.open(obj.comment_url,'_blank');
    btnGroup.appendChild(cmBtn);

    /* Share button â€“ uses Webâ€‘Share API or fallback modal */
    const shBtn = document.createElement('button');
    shBtn.className='icon-btn'; shBtn.title='Share'; shBtn.innerHTML='ðŸ”—';
    shBtn.onclick = function(e){
      e.stopPropagation();                         // prevent modal autoâ€‘hide
      const shareLink = SHARE_BASE + encodeURIComponent(key);
      shareArc(shareLink, obj.title);
    };
    btnGroup.appendChild(shBtn);

    card.appendChild(btnGroup);
    container.appendChild(card);
  });

  /* ----------------- highlight / focus : if image_id param supplied ------------ */
  if (targetId){
    setTimeout(()=>{
      const tgt = document.querySelector(`.card[data-pdf-id="${targetId}"]`);
      if (tgt){
        tgt.classList.add('highlight');
        tgt.scrollIntoView({behavior:'smooth',block:'center'});
        const fframe = tgt.querySelector('iframe');
        if (fframe) setTimeout(()=>requestFullscreen(fframe),700);
      }
    },150);
  }
}

loadVideos();
</script>
</body>
</html>
