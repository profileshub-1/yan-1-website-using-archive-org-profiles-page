<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>VERSE</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    body{
        font-family:Arial,Helvetica,sans-serif;
        background:#0f172a;
        color:#f8fafc;
        padding:20px;
        margin:0;
    }
    h1{ text-align:center; margin-bottom:20px; }

    .grid{
        display:grid;
        grid-template-columns:repeat(auto-fill,minmax(300px,1fr));
        gap:20px;
    }
    .card{
        background:rgba(255,255,255,0.08);
        padding:15px;
        border-radius:10px;
        backdrop-filter:blur(6px);
        display:flex;
        flex-direction:column;
        align-items:stretch;
    }
    iframe{
        width:100%;
        height:300px;
        border:none;
        border-radius:8px;
        background:#000;
    }
    .title{font-size:18px;margin-top:10px;font-weight:bold;}
    .date{opacity:.8;margin-top:5px;}
    .note{margin-top:8px;opacity:.9;}
    .button-group{
        margin-top:10px;
        display:flex;
        gap:10px;
        flex-wrap:wrap;
    }
    .icon-btn{
        padding:6px 12px;
        background:#1e40af;
        color:#fff;
        border-radius:5px;
        cursor:pointer;
        border:none;
        font-size:14px;
        display:flex;
        align-items:center;
        justify-content:center;
    }
    .icon-btn:hover{background:#1d4ed8;}
    .card.highlight{
        border:2px solid #3b82f6;
    }

    /* Share dialog */
    #shareDialog{
        display:none;
        position:fixed;
        top:50%;left:50%;
        transform:translate(-50%,-50%);
        background:#1e293b;
        padding:20px;
        border-radius:8px;
        color:#f8fafc;
        z-index:2000;
        min-width:260px;
    }
    #shareDialog input{
        width:100%;
        padding:8px;
        margin-bottom:10px;
        font-size:14px;
        border-radius:4px;
        border:1px solid #374151;
        background:#111827;
        color:#f8fafc;
    }
    #shareDialog button{
        padding:6px 12px;
        background:#1e40af;
        color:#fff;
        border:none;
        border-radius:5px;
        cursor:pointer;
    }
    #shareDialog button:hover{background:#1d4ed8;}
</style>
</head>

<body>
<h1>VERSE</h1>
<div id="gallery" class="grid"></div>

<!-- Share modal -->
<div id="shareDialog">
    <p>Share this PDF:</p>
    <input type="text" id="shareLinkInput" readonly>
    <button onclick="copyShareLink()">Copy</button>
</div>

<script>
const SHARE_BASE = "https://yan-1-related-1.github.io/yan-1-website-shared-links-redirecting/archive-profile-pdfs-page-shared-links-redirecting.html?pdf_id=";

// Utility to read query string
function getQueryParam(name){ const q=new URLSearchParams(window.location.search); return q.get(name); }

function getId(obj){ return obj.id ?? obj.pdf_id ?? ''; }

// Show share popup
function showShareDialog(link){
    const dlg=document.getElementById('shareDialog');
    const inp=document.getElementById('shareLinkInput');
    inp.value=link;
    dlg.style.display='block';
}

// Copy link -> clipboard
function copyShareLink(){
    const inp=document.getElementById('shareLinkInput');
    inp.select();
    document.execCommand('copy');
    alert('Link copied to clipboard!');
}

// Hide share dialog when clicking outside
document.addEventListener('click',ev=>{
    const dlg=document.getElementById('shareDialog');
    if(dlg.style.display==='block' && !dlg.contains(ev.target)){
        dlg.style.display='none';
    }
});

// Main loader
async function loadPDFs(){
    const resp=await fetch('pdfs.json');
    const items=await resp.json();

    const container=document.getElementById('gallery');
    container.innerHTML='';

    const targetId=getQueryParam('pdf_id');

    items.forEach(obj=>{
        const card=document.createElement('div');
        card.className='card';
        card.dataset.pdfId=getId(obj);

        // Embed URL
        const embedUrl=obj.archive_url.replace('/details/','/embed/');

        const iframe=document.createElement('iframe');
        iframe.src=embedUrl;
        iframe.allowFullscreen=true;
        iframe.style.border='none';
        iframe.style.background='#fff';
        card.appendChild(iframe);

        // Metadata
        const title=document.createElement('div');title.className='title';title.textContent=obj.title;card.appendChild(title);
        const date=document.createElement('div');date.className='date';date.textContent=obj.date;card.appendChild(date);
        const note=document.createElement('div');note.className='note';note.textContent=obj.note;card.appendChild(note);

        // Buttons
        const btnGroup=document.createElement('div');btnGroup.className='button-group';

        // Fullscreen icon
        const fsBtn=document.createElement('button');
        fsBtn.className='icon-btn';fsBtn.title='Fullscreen';fsBtn.innerHTML='â›¶';
        fsBtn.onclick=()=>{ pdfFrameRequestFullscreen(iframe); };
        btnGroup.appendChild(fsBtn);

        // Comments icon
        const cmBtn=document.createElement('button');cmBtn.className='icon-btn';cmBtn.title='Comments';cmBtn.innerHTML='ðŸ’¬';
        cmBtn.onclick=()=>{ window.open(obj.comment_url,'_blank'); };
        btnGroup.appendChild(cmBtn);

        // Share icon
        const shBtn=document.createElement('button');shBtn.className='icon-btn';shBtn.title='Share';shBtn.innerHTML='ðŸ”—';
        shBtn.onclick=()=>{ showShareDialog(SHARE_BASE+encodeURIComponent(getId(obj))); };
        btnGroup.appendChild(shBtn);

        card.appendChild(btnGroup);
        container.appendChild(card);
    });

    // Highlight target if id passed
    if(targetId){
        setTimeout(()=>{
            const tgt=document.querySelector(`.card[data-pdf-id="${targetId}"]`);
            if(tgt){ tgt.classList.add('highlight'); tgt.scrollIntoView({behavior:'smooth',block:'center'}); }
        },150);
    }
}

function pdfFrameRequestFullscreen(frame){
    if(frame.requestFullscreen) frame.requestFullscreen();
    else if(frame.webkitRequestFullscreen) frame.webkitRequestFullscreen();
    else if(frame.msRequestFullscreen) frame.msRequestFullscreen();
}

loadPDFs();
</script>
</body>
</html>
